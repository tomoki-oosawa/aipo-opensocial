<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="OSAPI People Sample">
    <Require feature="opensocial-1.0" />
    <Require feature="osapi" />
    <Require feature="dynamic-height"/>  
  </ModulePrefs>
  <Content type="html">
   <![CDATA[
   
<h1>OSAPI People Sample</h1>
<div id="result"></div>

<script type="text/javascript">

  gadgets.util.registerOnLoadHandler(init);

  function setResult(people) {
    html = new Array();
    html.push('<ul>');
      
    var size = people.list.length;
    for (var i = 0; i < size; i++) {
      html.push('<li>' + people.list[i].id + ":" + people.list[i].displayName + "</li>");
    };
    
    html.push('</ul>');
    var totalResults = people.totalResults;
    var startIndex = people.startIndex;
    var page = Math.ceil(totalResults / 10);
    for (var i = 0; i < page; i++) {
      var next = i * 10;
       html.push('<a href="javascript:void(0);" onclick="execute(' + next + ');">');
       html.push(i+1);
       html.push('</a>&nbsp;');
      
    }
    document.getElementById('result').innerHTML = html.join('');
    
    gadgets.window.adjustHeight(); 
  
  }
  
  function load(response) {
    gadgets.log(response);
      
    var people = response.people;
    setResult(people);
  }
  
  function execute(startIndex) {
    var batch = osapi.newBatch()
      .add('people', osapi.people.getOwnerFriends({ userId: '@owner', groupId: '@friends', startIndex: startIndex, count: 10 }));

    batch.execute(load);
  }
  
  function init() {
    execute(0);
  }
  
</script>


  ]]>
  </Content>
</Module>